# Analysis

We can divide this problem into two parts: choosing where to place the line, and choosing the permutation of players on the line (in other words, which players should be on which points on the line).

Regarding the permutation of players, the first observation that we can make is that preserving the initial X-ordering of the players is an optimal strategy. That means we should place the player with the lowest **X** coordinate value as the first player on the line, the player with the second lowest **X** coordinate value as the second player on the line, and so on. If there are ties, we can break them arbitrarily.

We can prove that this greedy strategy is optimal. First let us assume that there are two players with X-coordinates **X<sub>1</sub>** and **X<sub>2</sub>**, and let us denote the X-coordinate of the start of line as startX, whereas **X<sub>1</sub>** ≤ startX < **X<sub>2</sub>**. If we do not preserve the players' relative position on the final solution, we have that the first player will move for (startX + 1) - **X<sub>1</sub>** steps, and the second player will move for **X<sub>2</sub>** - startX steps, so the final solution equals -**X<sub>1</sub>** + **X<sub>2</sub>** + 1 steps. However, if we preserved the players' relative positions, the first player would move for startX - **X<sub>1</sub>** steps, and the second player would move for **X<sub>2</sub>** - (startX + 1) steps, so the final solution would equal -**X<sub>1</sub>** + **X<sub>2</sub>** - 1 steps, which is lower than the above strategy. For the other possible values of startX, which are startX < **X<sub>1</sub>** or **X<sub>2</sub>** ≤ startX, both permutations for the players result on the same amount of steps. Therefore, we can reach the conclusion that, for any solution, by swapping two players' order in order to preserve the players' initial relative positions, the total number of steps remains the same or decreases.

Now imagine that we have an arbitrary optimal solution S (not necessarily sorted on the players' X-coordinates). If we perform a swap, as described above, the solution does not get any worse, so it is still optimal. If we perform such a swap enough times we will reach a point in which the players are in non-descending order of their X coordinate, which is what our greedy solution looks like, and the solution is still optimal. Therefore, our greedy solution is optimal.

Regarding where to place the line, let _solutionFirstX_ be the X position of the first point on the line, and let _solutionRow_ be the Y position of the line.

## Test Set 1

Given the constraints of the Test Set 1, we can iterate through all possible values for _solutionFirstX_ and _solutionRow_ and check which combination results on the minimum total number of steps. The grid is unbounded, however we can bound the possible values for _solutionFirstX_ based on the initial **X** positions of the players, because placing the line entirely to the left of the player with the lowest **X** coordinate would make them all take an extra step to get there, which intuitively leads to a worse solution. The same applies on the right side. Let _minPlayerX_ represent the **X** value of the player the most to the left, and _maxPlayerX_ represent the **X** value of the player the most to the right. The number of possible values for _solutionFirstX_ range between _minPlayerX_-(**N**-1) and _maxPlayerX_. Given similar definitions for _minPlayerY_ and _maxPlayerY_, the same logic applies for _solutionRow_, which ranges between _minPlayerY_ and _maxPlayerY_.

To calculate what is the total number of steps for the players to reach the line at _candidateFirstX_ and _candidateRow_, iterate through all players in non-descending X-coordinate order and add their [Manhattan distances](https://xlinux.nist.gov/dads/HTML/manhattanDistance.html) to their relative locations on the line. In other words, the total number of steps equals the sum of |**X<sub>i</sub>** - (_candidateFirstX_ + (i - 1))| + |**Y<sub>i</sub>** - _candidateRow_|, for every player i in non-descending order of **X<sub>i</sub>**.

The complexity of given solution is O(**N** × log **N** + (_maxPlayerX_ - _minPlayerX_ + **N**) × (_maxPlayerY_ - _minPlayerY_ + 1) × **N**).

## Test Set 2

Given that the limits for **N** and the players initial positions are much greater in Test Set 2, the above mentioned solution would not be fast enough.

To divide our solution into smaller steps, we should notice that horizontal and vertical movement can be solved independently. In other words, the value _solutionRow_ does not affect how many horizontal steps the players will take, as well as _solutionFirstX_ does not affect how many vertical steps the players will take.

Let us start by finding the value for _solutionRow_. We can observe that most players will have to move vertically to reach _solutionRow_, either by moving up or moving down (and some will not have to move because they are initially on _solutionRow_). We want the total number of steps to be as small as possible, so a good candidate is the Y-position of the player that is positioned as the median among all players, regarding their initial Y-position.

We can prove that this is optimal as follows: first, let us start with the assumption that N is odd. If we set _solutionRow_ to be equal to **Y**<sub>⌈**N**/2⌉</sub> (the Y-position of the player in the middle), then we can see that there will be at least ⌊**N**/2⌋ players who are initially below or at the same line as the one in the middle, and at least ⌊**N**/2⌋ players who are initially above or at the same line as the one in the middle. Let us call totalStepsBelow the total number of steps taken by the ⌊**N**/2⌋ players who are initially below or at the same line as the one in the middle, and let us call totalStepsAbove the total number of steps taken by the ⌊**N**/2⌋ players who are initially above or at the same line as the one in the middle. As is, the total number of steps equals totalStepsBelow + totalStepsAbove. If we move _solutionRow_ one position up, then the player in the middle and all the players that were initially below or at the same line as the one in the middle will have to take one extra step to reach _solutionRow_, and, in the best scenario, all the players that were initially above as the one in the middle will have to take one less step to reach _solutionRow_. Therefore, the total number of steps would equal (totalStepsBelow + ⌊**N**/2⌋ + 1) + (totalStepsAbove - ⌊**N**/2⌋), which equals totalStepsBelow + totalStepsAbove + 1, which is worse than our first guess. The same applies for moving _solutionRow_ one position down. A similar logic can be used for when **N** is even.

Now we can use a similar approach for finding the value for _solutionFirstX_. Taking into account the fact that we want to preserve the players initial X-ordering, we can observe that for each player i, who has k<sub>i</sub> players to his left, the optimal value for _solutionFirstX_ would be **X<sub>i</sub>** - k<sub>i</sub>, because this way he would not have to move horizontally at all. Using the same logic described for finding _solutionRow_, we can find the optimal value for _solutionFirstX_ by picking the median of all players optimal values for _solutionFirstX_.

Using these strategies we can find the value for _solutionRow_ in O(**N** × log **N**) time by sorting the players by their initial Y-coordinate and picking the median value. Similarly, we can find the value for _solutionFirstX_ in O(**N** × log **N**) time by sorting the players by their initial X-coordinate and picking the median optimal value. Finally we can calculate the total number of steps in O(**N**) time, by using the strategy mentioned on Test Set 1 analysis. Therefore, the time complexity of the solution is O(**N** × log **N**).
